# RFC-0007: VS Code Extension and Online Editor

**状态**: Draft  
**创建日期**: 2024-12-30  
**作者**: WSX Team  
**关联 RFC**: RFC-0001, RFC-0006

## 摘要

设计并实现 Event DSL 的开发工具支持，包括 VS Code 扩展和在线编辑器，为开发者提供语法高亮、自动补全、错误检查和实时预览等功能。

**目标**：
- VS Code 扩展：提供完整的 IDE 支持
- 在线编辑器：提供浏览器内的 DSL 编辑和预览
- 语法高亮：提升代码可读性
- 智能提示：提高开发效率
- 错误检查：实时发现错误

## 动机

### 为什么需要 VS Code 扩展？

- **开发体验**：IDE 支持是专业工具的标志
- **提高效率**：自动补全和错误检查节省时间
- **降低错误**：实时验证减少语法错误
- **生态完善**：工具链完整提升项目专业度

### 为什么需要在线编辑器？

- **快速体验**：无需安装即可使用
- **在线演示**：方便展示和分享
- **学习工具**：帮助学习 DSL 语法
- **原型验证**：快速验证 DSL 配置

## 详细设计

### 1. VS Code 扩展

#### 1.1 功能列表

**核心功能**：
- ✅ 语法高亮（TextMate 语法）
- ✅ 自动补全（IntelliSense）
- ✅ 错误检查（实时验证）
- ✅ 代码格式化
- ✅ 代码片段（Snippets）
- ✅ 悬停提示（Hover）
- ✅ 定义跳转（Go to Definition）
- ✅ 符号搜索（Symbol Search）

**高级功能**：
- ✅ AST 可视化
- ✅ 实时预览
- ✅ 验证结果展示
- ✅ 模板生成
- ✅ 代码重构

#### 1.2 扩展结构

```
vscode-extension/
├── package.json                 # 扩展配置
├── tsconfig.json                # TypeScript 配置
├── src/
│   ├── extension.ts            # 扩展入口
│   ├── language/
│   │   ├── grammar.ts          # TextMate 语法
│   │   ├── completion.ts       # 自动补全
│   │   ├── validation.ts      # 错误检查
│   │   ├── formatting.ts       # 格式化
│   │   └── hover.ts           # 悬停提示
│   ├── commands/
│   │   ├── preview.ts          # 预览命令
│   │   ├── validate.ts        # 验证命令
│   │   └── generate.ts         # 生成命令
│   └── utils/
│       ├── parser.ts           # 解析器集成
│       └── ast.ts              # AST 工具
├── syntaxes/
│   └── event-dsl.tmLanguage.json # TextMate 语法文件
├── snippets/
│   └── event-dsl.code-snippets   # 代码片段
└── README.md                      # 扩展文档
```

#### 1.3 功能实现

**语法高亮**
- TextMate 语法定义
- 关键字高亮
- 字符串高亮
- 注释高亮
- 字段访问高亮

**自动补全**
- 关键字补全
- 字段名补全
- 操作符补全
- 类型补全
- 规则模板补全

**错误检查**
- 语法错误检测
- 类型错误检测
- 验证规则错误
- 实时错误标记
- 错误信息提示

**代码格式化**
- 缩进格式化
- 换行格式化
- 空格格式化
- 对齐格式化

**代码片段**
- 事件类型模板
- 验证规则模板
- 显示规则模板
- 行为规则模板
- 完整示例模板

#### 1.4 命令实现

**预览命令**
- 打开预览面板
- 实时渲染 AST
- 显示验证结果
- 显示渲染效果

**验证命令**
- 验证当前文件
- 显示验证错误
- 修复建议
- 批量验证

**生成命令**
- 生成 JSON Schema
- 生成 TypeScript 类型
- 生成示例代码

### 2. 在线编辑器

#### 2.1 功能列表

**核心功能**：
- ✅ Monaco Editor 集成
- ✅ 语法高亮
- ✅ 自动补全
- ✅ 错误检查
- ✅ 实时预览
- ✅ AST 可视化
- ✅ 验证结果展示
- ✅ 渲染效果预览

**高级功能**：
- ✅ 示例库
- ✅ 代码分享
- ✅ 导出功能
- ✅ 导入功能
- ✅ 主题切换

#### 2.2 项目结构

```
online-editor/
├── package.json
├── vite.config.ts
├── src/
│   ├── App.tsx                 # 主应用
│   ├── components/
│   │   ├── Editor.tsx         # Monaco 编辑器
│   │   ├── Preview.tsx        # 预览面板
│   │   ├── ASTViewer.tsx      # AST 可视化
│   │   ├── ValidationPanel.tsx # 验证面板
│   │   └── ExamplesPanel.tsx  # 示例面板
│   ├── hooks/
│   │   ├── useDSL.ts          # DSL 处理
│   │   ├── useValidation.ts   # 验证处理
│   │   └── usePreview.ts      # 预览处理
│   ├── utils/
│   │   ├── parser.ts          # 解析器集成
│   │   └── examples.ts        # 示例数据
│   └── styles/
│       └── editor.css          # 编辑器样式
├── public/
│   └── index.html
└── README.md
```

#### 2.3 功能实现

**Monaco Editor 集成**
- Monaco Editor 配置
- 语法高亮配置
- 自动补全配置
- 错误检查配置
- 主题配置

**实时预览**
- DSL 解析
- AST 生成
- 验证执行
- 渲染预览
- 实时更新

**AST 可视化**
- AST 树形展示
- 节点展开/折叠
- 节点高亮
- 节点搜索
- JSON 导出

**验证结果展示**
- 错误列表
- 错误定位
- 错误详情
- 修复建议
- 验证统计

**示例库**
- 示例列表
- 示例分类
- 示例搜索
- 示例加载
- 示例保存

**代码分享**
- 生成分享链接
- 导入分享链接
- 代码压缩
- URL 参数编码

### 3. 技术实现

#### 3.1 VS Code 扩展技术栈

- **Language Server Protocol (LSP)**：语言服务器协议（可选）
- **TextMate**：语法高亮
- **TypeScript**：扩展开发
- **VS Code API**：VS Code 扩展 API
- **@calenderjs/event-dsl**：DSL 解析和验证

#### 3.2 在线编辑器技术栈

- **React**：UI 框架
- **Vite**：构建工具
- **Monaco Editor**：代码编辑器
- **@calenderjs/event-dsl**：DSL 解析和验证
- **@calenderjs/calendar**：日历预览（可选）

### 4. 用户体验

#### 4.1 VS Code 扩展

**安装体验**
- 一键安装
- 自动配置
- 快速启用

**使用体验**
- 即时反馈
- 智能提示
- 错误高亮
- 快速修复

**性能体验**
- 快速响应
- 低资源占用
- 流畅操作

#### 4.2 在线编辑器

**访问体验**
- 无需注册
- 快速加载
- 响应式设计

**编辑体验**
- 流畅编辑
- 实时预览
- 错误提示
- 代码补全

**分享体验**
- 一键分享
- 链接访问
- 代码保存

## 实施计划

### 阶段 1: VS Code 扩展基础功能（3天）

**Day 1**：
- [ ] 项目初始化
- [ ] TextMate 语法定义
- [ ] 语法高亮实现
- [ ] 基础测试

**Day 2**：
- [ ] 自动补全实现
- [ ] 错误检查实现
- [ ] 代码格式化实现
- [ ] 代码片段实现

**Day 3**：
- [ ] 悬停提示实现
- [ ] 定义跳转实现
- [ ] 符号搜索实现
- [ ] 扩展打包

### 阶段 2: VS Code 扩展高级功能（2天）

**Day 4**：
- [ ] AST 可视化
- [ ] 实时预览
- [ ] 验证结果展示
- [ ] 预览命令实现

**Day 5**：
- [ ] 验证命令实现
- [ ] 生成命令实现
- [ ] 扩展文档
- [ ] 扩展发布

### 阶段 3: 在线编辑器（2天）

**Day 6**：
- [ ] 项目初始化
- [ ] Monaco Editor 集成
- [ ] 语法高亮配置
- [ ] 实时预览实现

**Day 7**：
- [ ] AST 可视化实现
- [ ] 验证结果展示
- [ ] 示例库实现
- [ ] 代码分享功能
- [ ] 部署上线

## 质量标准

### VS Code 扩展
- ✅ 所有功能正常工作
- ✅ 性能良好（响应时间 < 100ms）
- ✅ 错误处理完善
- ✅ 文档完整
- ✅ 测试覆盖

### 在线编辑器
- ✅ 所有功能正常工作
- ✅ 性能良好（加载时间 < 2s）
- ✅ 响应式设计
- ✅ 浏览器兼容
- ✅ 用户体验良好

## 交付物

### VS Code 扩展
1. **扩展包**：`.vsix` 文件
2. **Marketplace 发布**：VS Code Marketplace
3. **文档**：使用文档和 API 文档
4. **示例**：使用示例

### 在线编辑器
1. **网站**：在线编辑器网站
2. **部署**：生产环境部署
3. **文档**：使用文档
4. **示例库**：内置示例

## 后续计划

- **Language Server**：独立的语言服务器（可选）
- **其他编辑器支持**：Sublime Text, Atom 等（可选）
- **协作功能**：多人协作编辑（可选）
- **版本控制**：代码版本管理（可选）

## 维护计划

- **定期更新**：跟随 DSL 语法更新
- **Bug 修复**：及时修复问题
- **功能增强**：根据用户反馈增强功能
- **性能优化**：持续优化性能
