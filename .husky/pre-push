#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-push hook: åœ¨æ¨é€å‰è¿è¡Œæ›´ä¸¥æ ¼çš„æ£€æŸ¥
echo "ğŸš€ Running pre-push checks..."

# è¿è¡Œå®Œæ•´çš„æ„å»ºæ£€æŸ¥ï¼ˆè·³è¿‡ Next.js demoï¼Œå·²çŸ¥çš„ monorepo é—®é¢˜ï¼‰
echo "ğŸ“¦ Building all packages..."
nx run-many --target=build --parallel --exclude=@calenderjs/demos-react || {
  echo "âŒ Build failed! Please fix build errors before pushing."
  exit 1
}
echo "âš ï¸  Skipping Next.js demo build (known monorepo issue with react/jsx-runtime)"

# è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶
echo "ğŸ§ª Running full test suite..."
pnpm test || {
  echo "âŒ Tests failed! Please fix failing tests before pushing."
  exit 1
}

# è¿è¡Œ lint æ£€æŸ¥
echo "ğŸ” Running lint checks..."
pnpm lint || {
  echo "âŒ Lint errors found! Please fix lint errors before pushing."
  exit 1
}

echo "âœ… All pre-push checks passed! Pushing to remote..."
